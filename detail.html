<html>
	<head>
		<script src="JS/jquery-1.12.3.js"></script>
		<script src="JS/jquery.dataTables.min.js"></script>
		<script src="JS/global.js"></script>
		<script src="JS/csv.js"></script>
		<link rel="stylesheet" type="text/css" href="CSS/jquery.dataTables.min.css"/>
		<link rel="stylesheet" type="text/css" href="CSS/global.css"/>
		<script>
				var urlStr = window.location.href;
				// var url = new URL( urlStr);
				// var id = url.searchParams.get("id");
				// var name = url.searchParams.get("name");
				var id = getQueryString("id");
				var name = getQueryString("name");
				var communityServObject = {
					"5421": [
								[12, "Medical", "2020-01-15"],
								[2, "Animal", "2020-01-18"],
							],
					"8422": [
								[12, "Medical", "2020-02-15"],
								[2,  "Church", "2020-01-18"],
							],
					"8423": [
								[12, "Church", "2020-03-15"],
								[2,  "Animal", "2020-01-19"],
							],
				};
				// localStorage.setItem("communityService",   JSON.stringify(communityServObject));
				// try{ 				
				// 	communityServObject = JSON.parse(localStorage.getItem("communityService"));
				// }catch(e){ 
				// 	communityServObject = JSON.parse(getCookie("communityService")); 
				// }
				communityServObject = getData("communityService", {});
				if( checkNull(origDataSet)){
					origDataSet = [];
				}					
				if( checkNull(communityServObject)){
					communityServObject = {};
				}
				var origDataSet = communityServObject[id]; 
				if( checkNull(origDataSet)){
					origDataSet = [];
					communityServObject[id] = origDataSet
				}				
				var dataSet = [];
				resetDataSet();
				function resetDataSet(){
					var arrayDataset = []
					communityServObject[id] = origDataSet;
					// try{ 				
					// 	localStorage.setItem("communityService", JSON.stringify(communityServObject));
					// }catch(e){ 
					// 	setCookie("communityService", JSON.stringify(communityServObject)); 
					// }
					setData("communityService", communityServObject)
					for (var i = 0; i < origDataSet.length; i++) {
						var icons = setIcons(i);
						var detail = icons.detail;
						var edit =   icons.edit;
						var del =    icons.del;
						console.log(origDataSet[i]);
						var arr = JSON.parse(JSON.stringify(origDataSet[i]));
						arr.push(del);
						arr.push(edit);
						arrayDataset.push(arr);
					}
				 	dataSet = arrayDataset;
				}
				function setDataSource(){
					table = $('#example').DataTable( {
									data: dataSet,
									"iDisplayLength": 5,
									"lengthMenu": [[5, 10, -1], [5, 10, "All"]],
									columns: [
										{ title: "Hours" },
										{ title: "Type" },
										{ title: "Date" },
										{ title: "Delete" },
										{ title: "Edit" },
									]
								} );
				}					

				$(document).ready(function() {
					$("#id").text(id);
					$("#name").text(name);
					setDataSource();
				} );
				function reloadData(){
					$('#example').DataTable().clear().destroy();					
					setDataSource();		
				}	
				function formClear() {
					$("#txtRow").val("");
					$("#txtHours").val("");
					$("#txtDate").val("");
					$("#txtType").val("");
					$("#errorHours").text("");
					$("#errorDate").text("");
					$("#errorType").text("");					
					$("#txtDelete").val("");
					$("#txtEdit").val("");					
				}				
				function validate(){
					var hours = $("#txtHours").val();
					var type = $("#txtType").val();
					var dateVal = $("#txtDate").val();
					var error = false;
					var requiredMessage="This field is required."
					if(checkNull(hours) ){
						error = true;
						$("#errorHours").text(requiredMessage);
					}
					if(checkNull(type) ){
						error = true;
						$("#errorType").text(requiredMessage);
					}
					if(checkNull(dateVal) ){
						error = true;
						$("#errorDate").text(requiredMessage);
						
					}			
					return error;							
				}				
				function saveData() {
					if( validate()) {
						return;
					}					
					var row = $("#txtRow").val();
					var add = false;
					if(row === undefined || row === ""){
						row = dataSet.length;
						add = true;
					}					
					var icons = setIcons(row);
					var detail = icons.detail;
					var edit =   icons.edit;
					var del =    icons.del;				
					var array = [$("#txtHours").val(), $("#txtType").val(), $("#txtDate").val() ];

					if(add){
						origDataSet.push(array);
					}else{
						origDataSet[row] = array;								 
					}	
					resetDataSet();							 
					reloadData();
					formClear();
				}	
				function handleClick(type, row){
						console.log(' TYPE ---------- ' + type);
						const vals = dataSet[row];
						console.log(vals);
						if(type === 'edit'){
							$("#txtRow").val(row);
							$("#txtHours").val(vals[0]);
							$("#txtType").val(vals[1]);							
							$("#txtDate").val(vals[2]);
							$("#txtDelete").val(vals[3]);
							$("#txtEdit").val(vals[4]);
						}
						if(type === 'delete'){
							origDataSet.splice(row, 1);
							resetDataSet();	
							reloadData();
							formClear();
						}	
						if( type === 'details'){
							var id = vals[1];
							var name = vals[2];
							url = "detail.html?id="+id+"&name="+encodeURIComponent(name);
							MyWindow=window.open(url,'Details','width=900,height=700');
						}
				}


		</script>
	</head>
	<body>
		<div id="header" class="center">
			
			<div id="title"> 
				<img  id="logo" src="IMAGES/student.jpg" alt="Item added" > 
				Community Service for <span id="name"></span> (ID: <span id="id"></span>)
			<br>
			</div>
			<div style="clear: both;"></div>
		</div>

		<br><br>
		<table id="example" class="display" width="100%">
		</table>

		<div id="subtitle" > 
			<hr/>
			<div id="subtitleText" > Add/Edit</div>
			<hr/>
		</div>
		<div class="center"> 
			<form id="frmCadastre">
				<table>
					<input id="txtRow" name="txtRow" type="hidden">				
					<input id="txtEdit" name="txtEdit" type="hidden">				
					<input id="txtDelete" name="txtDelete" type="hidden">				
					<tr>
						<td><label for="txtHours">Hours:</label></td>
						<td><input type="number" id="txtHours" /></td> 
						<td>
							<span class="error" id="errorHours" > </span>
						</td> 							
					</tr>
					<tr>
						<td><label for="txtDate">Date:</label></td>
						<td><input type="date" id="txtDate" style="width:160px;"/></td> 
						<td>
							<span class="error" id="errorDate" > </span>
						</td> 							
					</tr>
					<tr>
						<td><label for="txtType">Type:</label></td>
						<td>
							<!-- <input type="text" id="txtGrade" /> -->
							<select id="txtType" >
								<option value="">Select Charity Type</option>
								<option value="Medical">Medical</option>
								<option value="Animal">Animal</option>
								<option value="School">School</option>
							  </select>							
						</td> 
						<td>
							<span class="error" id="errorType" > </span>
						</td> 							
					</tr>
					<tr>											
						<td><input type="button" value="Save" id="btnSave" onclick="saveData()"/></td> 
						<td><input type="button" value="Clear" id="btnClear"  onclick="formClear()"/></td> 
					</tr>
				</table>
			</form>
		</div> 
		<hr/>		



	</body>	
</html>