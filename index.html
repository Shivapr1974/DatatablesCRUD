<html>
	<head>
		<script src="JS/jquery-1.12.3.js"></script>
		<script src="JS/jquery.dataTables.min.js"></script>
		<script src="JS/global.js"></script>
		<script src="JS/csv.js"></script>
		<link rel="stylesheet" type="text/css" href="CSS/jquery.dataTables.min.css"/>
		<link rel="stylesheet" type="text/css" href="CSS/global.css"/>
		<script>
				var table = undefined;
				// [ "<img class=imgdetail  src='IMAGES/edit.png' onclick=\"handleClick('edit', 0)\">", "Tiger Nixon", "System Architect", "Edinburgh", "5421", "2011/04/25", "$320,800" , "<img class=imgdetail  src='IMAGES/delete.png' onclick=\"handleClick('delete', 0)\">" ],

				// var origDataSet = [
				// 		[ "5421", "Tiger Nixon", "A"],
				// 		[ "8422", "Gart Winter", "B"],		
				// 		[ "8423", "Lary Winter", "B"],		
				// ];
				// localStorage.setItem("studentList", JSON.stringify(origDataSet));
				var origDataSet = JSON.parse(localStorage.getItem("studentList"));
				if( checkNull(origDataSet)){
					origDataSet = [];
				}					
				var userObject = {};
				var dataSet = origDataSet;
				resetDataSet();
				$(document).ready(function() {
					setData();
				} );
			
				function resetDataSet(){
					var arrayDataset = []
					localStorage.setItem("studentList", JSON.stringify(origDataSet));
					for (var i = 0; i < origDataSet.length; i++) {
						var icons = setIcons(i);
						var detail = icons.detail;
						var edit =   icons.edit;
						var del =    icons.del;
						console.log(origDataSet[i]);
						var arr = [...origDataSet[i], detail, del, edit];
						arrayDataset.push(arr);
						userObject[origDataSet[i][0]] = [...origDataSet[i]];
					}
				 	dataSet = arrayDataset;
				}

				function setData(){
					table = $('#example').DataTable( {
									data: dataSet,
									columns: [
										{ title: "Number" },
										{ title: "Name" },
										{ title: "Grade" },
										{ title: "Community<br>Service" },
										{ title: "Delete" },
										{ title: "Edit" },
									]
								} );
				}	
				function reloadData(){
					$('#example').DataTable().clear().destroy();					
					setData();		
				}	
				function formClear() {
					$("#txtRow").val("");
					$("#txtDetails").val("");
					$("#txtID").val("");
					$("#txtName").val("");
					$("#txtGrade").val("");
					$("#errorID").text("");
					$("#errorName").text("");
					$("#errorGrade").text("");
					$("#txtDelete").val("");
					$("#txtEdit").val("");			
					$( "#txtID" ).prop( "disabled", false );							
				}				
				
				function validate(){
					var row = $("#txtRow").val();
					var id = $("#txtID").val();
					var name = $("#txtName").val();
					var grade = $("#txtGrade").val();
					var error = false;
					var requiredMessage="This field is required."
					var arr = userObject[id];
					if(checkNull(id) ){
						error = true;
						$("#errorID").text(requiredMessage);
					}
					if(checkNull(row) && !checkNull(userObject[id]) ){
						error = true;
						$("#errorID").text("Duplicate. Student with Id exists.");
					}
					if(checkNull(name) ){
						error = true;
						$("#errorName").text(requiredMessage);
					}
					if(checkNull(grade) ){
						error = true;
						$("#errorGrade").text(requiredMessage);
						
					}			
					return error;							
				}
				function saveData() {
					if( validate()) {
						return;
					}
					var row = $("#txtRow").val();
					var add = false;
					if(row === undefined || row === ""){
						row = dataSet.length;
						add = true;
					}					
					var icons = setIcons(row);
					var detail = icons.detail;
					var edit =   icons.edit;
					var del =    icons.del;				
					var array = [$("#txtID").val(), $("#txtName").val(), $("#txtGrade").val()];

					if(add){
						origDataSet.push(array);
					}else{
						origDataSet[row] = array;								 
					}	
					resetDataSet();							 
					reloadData();
					formClear();
				}	
				function handleClick(type, row){
						console.log(' TYPE ---------- ' + type);
						const vals = dataSet[row];
						console.log(vals);
						if(type === 'edit'){
							$("#txtRow").val(row);
							$("#txtID").val(vals[0]);
							$("#txtName").val(vals[1]);
							$("#txtGrade").val(vals[2]);
							$("#txtDetails").val(vals[3]);
							$("#txtDelete").val(vals[4]);
							$("#txtEdit").val(vals[5]);
							$( "#txtID" ).prop( "disabled", true );							
						}
						if(type === 'delete'){
							origDataSet.splice(row, 1);
							resetDataSet();	
							reloadData();
							formClear();
						}	
						if( type === 'details'){
							var id = vals[0];
							var name = vals[1];
							url = "detail.html?id="+id+"&name="+encodeURIComponent(name);
							MyWindow=window.open(url,'Details','width=900,height=700');
						}
				}

		</script>
	</head>
	<body>
		<div id="header" class="center">
			
			<div id="title"> 
				<img  id="logo" src="IMAGES/student.jpg" alt="Item added" > 
				Student Management System 
				<div id="name"> </div>
					
			<br>
			</div>
			<div style="clear: both;"></div>
		</div>

		<br><br><br><br>
		<table id="example" class="display" width="100%">
		</table>
		<!-- <button onclick="reloadData()">Reload</button> -->
		<div id="subtitle" > 
			<hr/>
			<div id="subtitleText" > Add/Edit</div>
			<hr/>
		</div>
		<div class="center"> 
			<form id="frmCadastre">
				<table>
					<input id="txtRow" name="txtRow" type="hidden">				
					<input id="txtDetails" name="txtDetails" type="hidden">				
					<input id="txtEdit" name="txtEdit" type="hidden">				
					<input id="txtDelete" name="txtDelete" type="hidden">				
					<tr>
						<td><label for="txtID">ID:</label></td>
						<td><input type="text" id="txtID" /></td> 
						<td>
							<span class="error" id="errorID" > </span>
						</td> 
					</tr>
					<tr>
						<td><label for="txtName">Name:</label></td>
						<td><input type="text" id="txtName" /></td> 
						<td>
							<span class="error" id="errorName" > </span>
						</td> 						
					</tr>
					<tr>
						<td><label for="txtGrade">Grade:</label></td>
						<td>
							<!-- <input type="text" id="txtGrade" /> -->
							<select id="txtGrade" style="width:160px;">
								<option value="">Select Grade</option>
								<option value="A">A</option>
								<option value="B">B</option>
								<option value="C">C</option>
								<option value="D">D</option>
								<option value="F">F</option>
							  </select>							
						</td> 
						<td>
							<span class="error" id="errorGrade" > </span>
						</td> 							
					</tr>
					<tr>											
						<td><input type="button" value="Save" id="btnSave" onclick="saveData()"/></td> 
						<td><input type="button" value="Clear" id="btnClear"  onclick="formClear()"/></td> 
					</tr>
				</table>
			</form>
		</div> 
		<hr/>
		
	</body>	
</html>